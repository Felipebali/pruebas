<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Mini RPG Interactivo</title>
<style>
  body { margin:0; overflow:hidden; background:#222; font-family:Arial; }
  canvas { display:block; margin:0 auto; background:#444; }
  #hud {
    position:absolute; top:10px; left:10px; color:white;
    background: rgba(0,0,0,0.5); padding:10px; border-radius:5px;
  }
  .bar {
    height:15px; background:red; border-radius:5px; margin-top:3px;
  }
</style>
</head>
<body>

<div id="hud">
  Vida: <div class="bar" id="playerHealth"></div>
  <div>Puntuación: <span id="score">0</span></div>
  <div>Nivel: <span id="level">1</span></div>
</div>

<canvas id="gameCanvas" width="800" height="600"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// ------------------- Jugador -------------------
const player = {
  x: 400, y: 300, size: 30,
  color: "blue", speed: 4,
  health: 100,
  score: 0,
  level: 1
};

// ------------------- Enemigos -------------------
let enemies = [];
function spawnEnemy() {
  const enemy = {
    x: Math.random()*780+10,
    y: Math.random()*580+10,
    size: 30,
    color: "red",
    speed: 1+player.level*0.2,
    health: 50 + player.level*10
  };
  enemies.push(enemy);
}
for(let i=0;i<3;i++) spawnEnemy();

// ------------------- Monedas -------------------
let coins = [];
function spawnCoin() {
  const coin = {
    x: Math.random()*780+10,
    y: Math.random()*580+10,
    size: 15,
    color: "yellow"
  };
  coins.push(coin);
}
for(let i=0;i<5;i++) spawnCoin();

// ------------------- Movimiento -------------------
const keys = {};
window.addEventListener("keydown", e=>keys[e.key.toLowerCase()]=true);
window.addEventListener("keyup", e=>keys[e.key.toLowerCase()]=false);

// ------------------- Actualizar HUD -------------------
const healthBar = document.getElementById("playerHealth");
const scoreEl = document.getElementById("score");
const levelEl = document.getElementById("level");
function updateHUD() {
  healthBar.style.width = player.health + "px";
  scoreEl.textContent = player.score;
  levelEl.textContent = player.level;
}

// ------------------- Lógica -------------------
function gameLoop() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Movimiento jugador
  if(keys["w"] && player.y-player.speed>0) player.y -= player.speed;
  if(keys["s"] && player.y+player.speed<canvas.height-player.size) player.y += player.speed;
  if(keys["a"] && player.x-player.speed>0) player.x -= player.speed;
  if(keys["d"] && player.x+player.speed<canvas.width-player.size) player.x += player.speed;

  // Dibujar jugador
  ctx.fillStyle = player.color;
  ctx.fillRect(player.x, player.y, player.size, player.size);

  // Dibujar y mover enemigos
  enemies.forEach((e,i)=>{
    const dx = player.x - e.x;
    const dy = player.y - e.y;
    const dist = Math.sqrt(dx*dx + dy*dy);
    e.x += (dx/dist)*e.speed;
    e.y += (dy/dist)*e.speed;

    ctx.fillStyle = e.color;
    ctx.fillRect(e.x, e.y, e.size, e.size);

    // Colisión jugador-enemigo
    if(dist < (player.size+e.size)/2) {
      player.health -= 0.3;
      if(player.health<=0){
        alert("¡Has muerto! Reiniciando juego...");
        player.health=100;
        player.score=0;
        player.level=1;
        enemies=[];
        for(let i=0;i<3;i++) spawnEnemy();
        coins=[];
        for(let i=0;i<5;i++) spawnCoin();
      }
    }

    // "Matar" enemigo si space está presionado y cerca
    if(keys[" "] && dist<40){
      e.health -=5;
      if(e.health<=0){
        enemies.splice(i,1);
        player.score += 10;
        spawnEnemy();
      }
    }
  });

  // Dibujar y recoger monedas
  coins.forEach((c,i)=>{
    ctx.fillStyle = c.color;
    ctx.beginPath();
    ctx.arc(c.x+c.size/2,c.y+c.size/2,c.size/2,0,Math.PI*2);
    ctx.fill();

    const dx = player.x - c.x;
    const dy = player.y - c.y;
    if(Math.sqrt(dx*dx+dy*dy)<player.size){
      coins.splice(i,1);
      player.score +=5;
      spawnCoin();
    }
  });

  // Subir de nivel cada 50 puntos
  if(player.score >= player.level*50){
    player.level++;
    player.health=100;
    for(let i=0;i<player.level;i++) spawnEnemy();
  }

  updateHUD();
  requestAnimationFrame(gameLoop);
}
gameLoop();
</script>
</body>
</html>
